<div class="student-dashboard p-6">
  <div class="dashboard-grid grid grid-cols-1 md:grid-cols-2 gap-4">

        <!-- Thông tin sinh viên -->
        <!-- <div class="bg-white rounded-xl shadow-md p-6 hover:shadow-lg transition cursor-pointer"
          (click)="loadProfile()">
          <h3 class="text-xl font-bold mb-4 text-gray-800">Thông tin sinh viên</h3>
          <div class="flex items-center space-x-4">
            <div class="avatar" *ngIf="userProfile?.anhDaiDien"><img [src]="userProfile.anhDaiDien" alt="avatar"/></div>
            <div class="avatar placeholder" *ngIf="!userProfile?.anhDaiDien">{{ (userProfile?.hoTen || authUser?.hoTen || authUser?.tenNguoiDung || 'U').charAt(0) }}</div>
            <div class="flex-1">
              <div class="text-2xl font-semibold text-gray-900 mb-1">
                {{ userProfile?.hoTen || userProfile?.HoTen || authUser?.hoTen || authUser?.HoTen ||
                authUser?.tenNguoiDung || authUser?.TenNguoiDung || authUser?.tenDangNhap || authUser?.TenDangNhap ||
                authUser?.username }}
              </div>
              <div class="text-sm text-gray-500 mb-1">MSSV: {{ userProfile?.maSinhVien || userProfile?.MaSinhVien ||
                authUser?.maSinhVien || authUser?.MaSinhVien || authUser?.maNguoiDung || authUser?.MaNguoiDung || '-' }}
              </div>
              <div class="text-sm text-gray-500">Ngành: {{ userProfile?.nganh || userProfile?.Nganh || '-' }}</div>
            </div>
          </div>
          <div class="mt-4 text-sm text-gray-600 space-y-1">
            <div>Ngày sinh: {{ userProfile?.ngaySinh || userProfile?.NgaySinh || authUser?.ngaySinh ||
              authUser?.NgaySinh || '-' }}</div>
            <div>Năm nhập học: {{ userProfile?.namNhapHoc || userProfile?.NamNhapHoc || authUser?.namNhapHoc ||
              authUser?.NamNhapHoc || '-' }}</div>
          </div>
        </div> -->

        <!-- Lịch học hôm nay -->
        <!-- <div class="bg-white rounded-xl shadow-md p-6 hover:shadow-lg transition cursor-pointer"
          (click)="loadTodaySchedule()">
          <h3 class="text-xl font-bold mb-3 text-gray-800">Lịch học hôm nay</h3>
          <div *ngIf="!todaySchedule || todaySchedule.length === 0" class="text-sm text-gray-400">Không có lịch học hôm
            nay</div>
          <div *ngIf="todaySchedule && todaySchedule.length" class="overflow-auto max-h-48">
            <table class="w-full text-left border-collapse">
              <thead class="bg-gray-100 sticky top-0">
                <tr>
                  <th class="p-2 text-gray-600 font-medium border-b">Môn</th>
                  <th class="p-2 text-gray-600 font-medium border-b">Giờ</th>
                  <th class="p-2 text-gray-600 font-medium border-b">Phòng</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let s of todaySchedule" class="hover:bg-gray-50">
                  <td class="p-2 border-b">{{ s?.TenMonHoc || s?.tenMonHoc || s?.monHoc || s?.ten || '-' }}</td>
                  <td class="p-2 border-b">{{ s?.Gio || s?.gio || (s?.TietBatDau ? (s.TietBatDau + ' - ' + (s.TietBatDau
                    + (s.SoTiet||1) -1)) : '-') }}</td>
                  <td class="p-2 border-b">{{ s?.Phong || s?.phong || s?.TenPhong || '-' }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div> -->

        <!-- Tỉ lệ điểm danh theo môn học -->
        <div class="bg-white rounded-xl shadow-md p-6 hover:shadow-lg transition">
          <h3 class="text-xl font-bold mb-3 text-gray-800">Tỉ lệ điểm danh theo môn học</h3>
            <div class="flex items-center gap-3 mb-3 flex-wrap">
              <label class="text-sm text-gray-600 mr-2 flex-shrink-0">Học kỳ:</label>
              <nz-select [(ngModel)]="selectedSemesterForStats" (ngModelChange)="onSelectSemesterForStats($event)" nzAllowClear nzPlaceHolder="Chọn học kỳ" class="w-full sm:w-auto" [nzDisabled]="semestersLoading || attendanceRatesLoading">
                <nz-option *ngFor="let s of semesters" [nzLabel]="s.label" [nzValue]="s.key"></nz-option>
              </nz-select>
            </div>
            <div class="relative">
              <canvas id="studentAttendanceChart" class="w-full h-48"></canvas>
              <div *ngIf="attendanceRatesLoading" class="absolute inset-0 flex flex-col items-center justify-center bg-white/60">
                <svg class="w-5 h-5 animate-spin text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                </svg>
                <div class="text-sm text-gray-600 mt-2">Đang tải thống kê...</div>
              </div>
            </div>
          <div *ngIf="attendanceRates && attendanceRates.length" class="mt-4 text-sm space-y-1">
            <ul class="list-disc list-inside">
              <!-- <li *ngFor="let r of attendanceRates">
                <span class="font-semibold">{{ r.subject }}:</span> {{ r.percent }}% ({{ r.present }}/{{ r.total }})
              </li> -->
            </ul>
          </div>
            <div *ngIf="(!selectedSemesterForStats || selectedSemesterForStats === 'choose')" class="mt-3 text-sm text-gray-500">Chọn học kỳ để xem thống kê.</div>
            <div *ngIf="selectedSemesterForStats && !(attendanceRates && attendanceRates.length) && !attendanceRatesLoading" class="mt-3 text-sm text-gray-500">Không có dữ liệu điểm danh cho học kỳ này.</div>
        </div>

        <!-- Lớp học phần -->
        <div class="bg-white rounded-xl shadow-md p-4 hover:shadow-lg transition">
          <div class="flex items-center justify-between mb-3 flex-wrap sm:flex-nowrap">
            <h3 class="text-xl font-bold text-gray-800 flex-1 min-w-0">Lớp học phần</h3>
            <div class="ml-3 w-full sm:w-44 mt-2 sm:mt-0">
              <nz-select [(ngModel)]="selectedSemesterKey" (ngModelChange)="onSelectSemester($event)" nzPlaceHolder="HK" [nzLoading]="semestersLoading" nzAllowClear nzNotFoundContent="Không có học kỳ" class="w-full">
                <nz-option *ngFor="let s of semesters" [nzValue]="s.key" [nzLabel]="s.label"></nz-option>
              </nz-select>
            </div>
          </div>

          <div *ngIf="(!semesterClassSections || semesterClassSections.length === 0) && (!classSections || classSections.length === 0)" class="text-sm text-gray-400 p-4">
            Không tìm thấy lớp học phần
          </div>

          <div *ngIf="semesterClassSections && semesterClassSections.length" class="max-h-56 overflow-y-auto border border-gray-100 rounded">
            <div *ngFor="let c of semesterClassSections" class="flex items-center justify-between px-4 py-3 border-b last:border-b-0 hover:bg-gray-50">
              <div>
                <a class="text-blue-600 hover:underline font-medium">{{ c.id }}</a>
                <div class="text-gray-600 text-sm">{{ c.ten }}</div>
              </div>
            </div>
          </div>

          <div *ngIf="(!semesterClassSections || semesterClassSections.length === 0) && classSections && classSections.length" class="max-h-56 overflow-y-auto border border-gray-100 rounded">
            <div *ngFor="let c of classSections" class="flex items-center justify-between px-4 py-3 border-b last:border-b-0 hover:bg-gray-50">
              <div>
                <a class="text-blue-600 hover:underline font-medium">{{ c.maLopHocPhan || c.id || c.ma || '' }}</a>
                <div class="text-gray-600 text-sm">{{ c.tenLopHocPhan || c.ten || c.ten || c.label || '' }}</div>
              </div>
            </div>
          </div>
        </div>
  </div>
</div>
